# Skill Memory

> Persistent Skill Memory for Agent Context - Reads skill-index.json for metadata and SKILL.md for protocols.

## Overview

SkillMemory manages skill information for the context system. It reads `skill_index.json` for skill metadata (including `require_refs`) and `SKILL.md` for skill protocol content.

## Key Features

- **Core Skills**: Preloaded skills always available (git, memory, knowledge)
- **Active Skills**: Skills relevant to the current task
- **Require Refs**: External docs declared in SKILL.md frontmatter

## Architecture

```
SkillMemory
├── skill_index.json    # Skill metadata (generated by Rust scanner)
├── SKILL.md files      # Skill protocol content
└── require_refs        # External documentation references
```

## Usage

```python
from agent.core.skill_memory import SkillMemory, get_skill_memory

# Get singleton
memory = get_skill_memory()

# Get all skill prompts (core + active)
prompts = memory.get_all_prompts(active_skills={"writer", "documentation"})

# Get require_refs for a skill
refs = memory.get_require_refs("git")
# Returns: ["docs/git-workflow.md", "references/commit-patterns.md"]

# Get all require_refs for active skills
all_refs = memory.get_all_require_refs(active_skills={"git", "writer"})
```

## Core vs Active Skills

### Core Skills

Always loaded in context, configured in settings (system: packages/conf/settings.yaml, user: $PRJ_CONFIG_HOME/omni-dev-fusion/settings.yaml):

```yaml
skills:
  preloaded: ["knowledge", "memory", "git"] # Default
```

```python
core_prompts = memory.get_core_prompts()
# Returns: {"git": "...", "memory": "...", "knowledge": "..."}
```

### Active Skills

Dynamically loaded based on task relevance:

```python
active_prompts = memory.get_active_prompts({"writer", "documentation"})
```

## Require Refs

External documentation referenced in SKILL.md frontmatter:

```yaml
# assets/skills/git/SKILL.md
---
name: "git"
require_refs:
  - "docs/git-workflow.md"
  - "references/commit-patterns.md"
---
```

```python
refs = memory.get_require_refs("git")
# ["docs/git-workflow.md", "references/commit-patterns.md"]
```

## Schema-Driven Validation

Uses `skill_metadata.schema.json` (generated by Rust) for metadata validation:

```json
{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "type": "object",
  "properties": {
    "name": { "type": "string" },
    "requireRefs": {
      "type": "array",
      "items": { "type": "string" }
    }
  }
}
```

## Integration

```
┌──────────────┐     ┌──────────────┐     ┌──────────────────┐
│ SkillMemory  │ --> │ Context      │ --> │ Agent Context    │
│ (prompts)    │     │ Orchestrator │     │ (LLM Input)      │
└──────────────┘     └──────────────┘     └──────────────────┘
```

Used by ContextOrchestrator for Layer1.5 (SkillMemory) injection:

```python
prompts = memory.get_all_prompts(active_skills)
# Passed to: orchestrator.build_prompt(task, history, skill_prompts=prompts)
```

## Configuration

### Skills Directory

Determined by `SKILLS_DIR()` from `common.skills_path`.

### Default Core Skills

If settings unavailable:

```python
_core_skills = {"knowledge", "memory", "git"}
```

## Related Documentation

- [Context Orchestrator](./context-orchestrator.md) - Layer1.5 SkillMemory
- [Skill Standard](./skill-standard.md) - SKILL.md frontmatter specification
- [Skill Discovery](../../llm/skill-discovery.md) - How skills are indexed

---

_Built on standards. Not reinventing the wheel._
