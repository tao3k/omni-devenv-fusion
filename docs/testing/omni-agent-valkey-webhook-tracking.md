# Omni-Agent Valkey Webhook Tracking

Tracking record for live webhook dedup verification across stress, dual-HTTP, and dual-process
scenarios.

## Scope

- Crate: `packages/rust/crates/omni-agent`
- Focus area: Telegram webhook dedup with Valkey backend
- Validation style: ignored live tests and wrapper `just` commands

## Canonical Commands

```bash
just test-omni-agent-valkey-stress
just test-omni-agent-valkey-session-gate
just test-omni-agent-valkey-session-context
just test-omni-agent-valkey-multi-http
just test-omni-agent-valkey-multi-process
just test-omni-agent-valkey-full
python3 scripts/channel/test_omni_agent_valkey_suite.py --suite full redis://127.0.0.1:6379/0
python3 scripts/channel/test_omni_agent_memory_suite.py --suite quick --max-wait 25 --max-idle-secs 25
python3 scripts/channel/test_omni_agent_memory_suite.py --suite full --with-valkey --valkey-url redis://127.0.0.1:6379/0
just test-omni-agent-memory-benchmark both 1 90 40 tao3k
python3 scripts/channel/test_omni_agent_memory_benchmark.py --username tao3k --iterations 1 --max-wait 90 --max-idle-secs 40
python3 scripts/channel/reconstruct_omni_agent_trace.py .run/logs/omni-agent-webhook.log --chat-id 1304799691 --json-out .run/reports/omni-agent-trace-reconstruction.json --markdown-out .run/reports/omni-agent-trace-reconstruction.md
python3 scripts/channel/test_omni_agent_command_events.py --max-wait 25 --max-idle-secs 25
python3 scripts/channel/test_omni_agent_dedup_events.py --max-wait 25
python3 scripts/channel/check_omni_agent_event_sequence.py .run/logs/omni-agent-debug.log --strict --require-memory --expect-memory-backend valkey
just agent-channel-blackbox-dedup
just check-omni-agent-event-sequence .run/logs/omni-agent-debug.log true true valkey
cargo test -p omni-agent --test channels_commands --test channels_webhook --test channels_webhook_stress --test channels_session_partition
cargo test -p omni-agent runtime_handle_inbound_session_partition_
```

Note: the `test-omni-agent-valkey-*.sh` scripts and `test-omni-agent-memory-*.sh` scripts are
compatibility wrappers that delegate to Python suite runners.

## Debug Event Filters

Use the following `RUST_LOG` filters when tracing distributed session behavior with Valkey:

```bash
RUST_LOG='omni_agent=debug,agent.memory=debug,session=debug,telegram.dedup=debug'
```

Key memory persistence events:

- `agent.memory.backend.initialized`
- `agent.memory.state_load_succeeded`
- `agent.memory.state_load_failed`
- `agent.memory.state_save_succeeded`
- `agent.memory.state_save_failed`
- `agent.memory.recall.planned`
- `agent.memory.recall.injected`
- `agent.memory.recall.skipped`

## End-to-End Trace Sequence

When debugging a live Telegram + Valkey issue, inspect events in this order:

1. Webhook dedup decision:
   - `telegram.dedup.update_accepted`
   - `telegram.dedup.evaluated`
   - `telegram.dedup.duplicate_detected` (when dropped)
2. Foreground session gate lease:
   - `session.gate.lease.acquired`
   - `session.gate.lease.renewed`
   - `session.gate.lease.released`
3. Session window operations:
   - `session.window_slots.loaded`
   - `session.window_slots.appended`
   - `session.window_slots.drained` (if consolidation drains old turns)
4. Memory persistence lifecycle:
   - `agent.memory.backend.initialized`
   - `agent.memory.state_load_succeeded` / `agent.memory.state_load_failed`
   - `agent.memory.state_save_succeeded` / `agent.memory.state_save_failed`
   - `agent.memory.recall.planned`
   - `agent.memory.recall.injected` / `agent.memory.recall.skipped`

This sequence gives a minimal causality chain from inbound update to persisted memory state and
memory-context injection decision.

## Fault Diagnosis Matrix

| Symptom                                              | Event pattern to check                                                                                                                                | Likely cause                                                                                   | First action                                                                                                                                     |
| ---------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------ |
| Duplicate Telegram replies                           | `telegram.dedup.update_accepted` missing on accepted requests, `telegram.dedup.evaluated` missing, or repeated `duplicate=false` for same `update_id` | Dedup backend misconfigured, stale runtime binary, key-prefix collision, or Valkey unavailable | Check dedup backend init event, restart with latest binary, verify `VALKEY_URL`/dedup key prefix, and confirm one shared Valkey across instances |
| Same logical session runs concurrently               | `session.gate.lease.acquired` appears for overlapping requests without matching lock ownership pattern                                                | Session gate running in memory mode across multiple instances, or lease key mismatch           | Verify `session.gate.backend.initialized` is `valkey` and key prefix is shared                                                                   |
| Requests stall on foreground lock                    | Repeated `session.gate.lease.acquire_timeout` or recurring `session.valkey.command.retry_failed`                                                      | Lease TTL too long, leaked lease owner, or Valkey latency/errors                               | Reduce lease TTL / acquire timeout, inspect release events, and check Valkey health                                                              |
| Context window appears empty after `/resume`         | `session.context_window.resume_missing` after a previous reset                                                                                        | Backup snapshot absent/expired, wrong session partition, or cross-instance key mismatch        | Verify reset produced backup events and both instances use the same session key prefix/partition                                                 |
| Memory not restored at startup                       | `agent.memory.state_load_failed` at startup                                                                                                           | Invalid/unreachable Valkey URL or corrupted payload                                            | Check `memory.persistence_backend`, URL validity, and strict mode; inspect error payload                                                         |
| Memory updates not durable                           | `agent.memory.state_save_failed` after `turn_store`/`consolidation`                                                                                   | Backend write failures or backend selected unexpectedly                                        | Check `agent.memory.backend.initialized` + save failure reason; confirm expected backend mode (`auto/local/valkey`)                              |
| Unexpected local JSON snapshots in Valkey deployment | Local files created while expecting Valkey-only                                                                                                       | `auto` mode selected local due to missing URL                                                  | Verify `agent.memory.backend.initialized` backend field and ensure `VALKEY_URL` (or `session.valkey_url`) is set                                 |

### Automated Checker

Use the checker to validate event presence/order automatically:

```bash
just check-omni-agent-event-sequence .run/logs/omni-agent-debug.log true true valkey
```

Arguments after `<log_file>` are:

- `strict`: `true` treats warnings as failures.
- `require_memory`: `true` requires memory lifecycle events.
- `expect_memory_backend`: `local` or `valkey`.

## CI Automation

- Workflow: `.github/workflows/omni-agent-valkey-live.yaml`
- Triggers:
  - `workflow_dispatch` (manual run)
  - nightly schedule at `02:30 UTC`
- Behavior:
  - starts local Valkey via `just valkey-start`
  - runs `just test-omni-agent-valkey-full`
  - always attempts cleanup via `just valkey-stop`
- First CI run status: pending (no recorded workflow run ID yet)

## Latest Verification Snapshot

| Date (UTC) | Environment                                                                                      | Command                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | Result | Notes                                                                                                                                                                                                                                                                                                                                              |
| ---------- | ------------------------------------------------------------------------------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------- |
| 2026-02-19 | local dev (macOS)                                                                                | `cargo check -p omni-agent && cargo test -p omni-agent --test channels_commands --test channels_managed_commands -q && cargo test -p omni-agent --test channels_discord_slash_authorization --test channels_discord --test channels_discord_ingress -q && cargo test -p omni-agent process_discord_message_denies_unauthorized_ -q && cargo test -p omni-agent process_discord_message_handles_ -q && cargo test -p omni-agent process_discord_message_resume_status_is_allowed_for_non_admin -q`                       | pass   | Refactored managed command parsing to shared macro-based parser (`eq_any_ignore_ascii!`) and reused it across Telegram commands and Discord managed runtime; kept Telegram partition parsing channel-specific and preserved Discord partition aliases.                                                                                             |
| 2026-02-19 | local dev (macOS)                                                                                | `cargo check -p omni-agent && cargo test -p omni-agent --test channels_managed_commands --test channels_discord_slash_authorization --test channels_discord --test channels_discord_ingress -q && cargo test -p omni-agent process_discord_message_denies_unauthorized_ -q && cargo test -p omni-agent process_discord_message_handles_ -q && cargo test -p omni-agent process_discord_message_resume_status_is_allowed_for_non_admin -q`                                                                               | pass   | Implemented Discord managed runtime execution path (session/control/background commands handled before LLM), added Discord JobManager + completion push loop, added Discord runtime managed command regressions under `tests/discord_runtime/`, and expanded managed command partition detection to include Discord mode aliases.                  |
| 2026-02-19 | local dev (macOS)                                                                                | `cargo check -p omni-agent && cargo test -p omni-agent --test channels_managed_commands --test channels_discord_slash_authorization --test channels_discord --test channels_discord_ingress --test channels_telegram_slash_authorization --test config_settings -q && cargo test -p omni-agent process_discord_message_denies_unauthorized_ -- --nocapture`                                                                                                                                                             | pass   | Added shared managed command classifier/scopes, reused scope constants across Telegram/Discord, introduced Discord managed slash ACL policy/config/env wiring, and enabled Discord runtime ACL pre-check replies for managed control/slash commands.                                                                                               |
| 2026-02-19 | local dev (macOS)                                                                                | `cargo test -p omni-agent --no-run && cargo test -p omni-agent --test config_settings --test channels_discord --test channels_discord_parsing --test channels_discord_ingress --test channels_discord_send`                                                                                                                                                                                                                                                                                                             | pass   | Replaced Rust binary entrypoint namespace `main_*` with domain-based `nodes/*` (`channel/gateway/repl/schedule/stdio`), wired Discord provider end-to-end in CLI/runtime/settings, and migrated control-command rule syntax from regex to user-friendly command selectors (`/session partition=>owner`, `/reset,/clear=>ops`, `session.*=>owner`). |
| 2026-02-19 | local dev (macOS)                                                                                | `cargo test -p omni-agent --test channels_telegram --test config_settings --test channels_webhook --test channels_webhook_stress --test channels_commands && cargo test -p omni-agent channels::telegram::runtime::tests::`                                                                                                                                                                                                                                                                                             | pass   | Added modular shared control-command authorization policy and Telegram `control_command_allow_from` override (`OMNI_AGENT_TELEGRAM_CONTROL_COMMAND_ALLOW_FROM`), then re-verified telegram/runtime/webhook/config regressions.                                                                                                                     |
| 2026-02-19 | local dev (macOS)                                                                                | `cargo test -p omni-agent channels::telegram::runtime::tests:: && cargo test -p omni-agent --test channels_telegram --test config_settings --test channels_webhook --test channels_webhook_stress --test channels_commands`                                                                                                                                                                                                                                                                                             | pass   | Extended control-command admin gating to `/reset` and mutating `/resume` paths (read-only `/resume status` remains open), added dedicated runtime regressions under `tests/telegram_runtime/session_control_admin.rs`, and re-verified telegram/webhook/config regression set.                                                                     |
| 2026-02-19 | local dev (macOS)                                                                                | `cargo test -p omni-agent --test channels_telegram --test config_settings --test channels_webhook --test channels_webhook_stress && cargo test -p omni-agent runtime_handle_inbound_session_partition_`                                                                                                                                                                                                                                                                                                                 | pass   | Added and verified per-command admin authorization rules (`OMNI_AGENT_TELEGRAM_ADMIN_COMMAND_RULES`) with regex matching and runtime control-command gating.                                                                                                                                                                                       |
| 2026-02-19 | local dev (macOS)                                                                                | `cargo test -p omni-agent --test channels_commands --test channels_webhook --test channels_webhook_stress --test channels_session_partition && cargo test -p omni-agent runtime_handle_inbound_session_partition_`                                                                                                                                                                                                                                                                                                      | pass   | Re-verified Telegram session-partition control path after admin-allowlist plumbing (`telegram.admin_users`) and webhook builder wiring updates.                                                                                                                                                                                                    |
| 2026-02-18 | local dev (macOS), live webhook runtime                                                          | `python3 scripts/channel/test_omni_agent_session_matrix.py --max-wait 45 --max-idle-secs 30`                                                                                                                                                                                                                                                                                                                                                                                                                            | pass   | Real dual-session matrix passed (`8/8`), validating reset/resume/session command isolation across two logical sessions in the same runtime.                                                                                                                                                                                                        |
| 2026-02-18 | local dev (macOS), live webhook runtime                                                          | `python3 scripts/channel/test_omni_agent_memory_benchmark.py --chat-id 1304799691 --user-id 1304799695 --mode baseline --iterations 1 --max-wait 90 --max-idle-secs 40`                                                                                                                                                                                                                                                                                                                                                 | pass   | Pinned-target memory benchmark completed with fixed `session_target`; runtime logs stayed on `session_key=1304799691:1304799695` and showed no session drift.                                                                                                                                                                                      |
| 2026-02-18 | local dev (macOS)                                                                                | `cargo test -p omni-memory --test test_scope && cargo test -p omni-agent --test agent_memory_scope_isolation`                                                                                                                                                                                                                                                                                                                                                                                                           | pass   | Added regression coverage for memory scope isolation: scoped recall excludes other sessions and persisted turn episodes carry the expected per-session scope keys.                                                                                                                                                                                 |
| 2026-02-18 | local dev (macOS), live webhook runtime                                                          | `python3 scripts/channel/test_omni_agent_memory_benchmark.py --username tao3k --iterations 1 --max-wait 90 --max-idle-secs 40`                                                                                                                                                                                                                                                                                                                                                                                          | pass   | New memory A/B benchmark runner completed baseline vs adaptive replay; report artifacts written to `.run/reports/omni-agent-memory-benchmark.{json,md}` with zero MCP-error interference in scored turns.                                                                                                                                          |
| 2026-02-18 | local dev (macOS), live webhook runtime + Valkey                                                 | `python3 scripts/channel/test_omni_agent_memory_suite.py --suite full --with-valkey --valkey-url redis://127.0.0.1:6379/0 --max-wait 60 --max-idle-secs 40 --username tao3k`                                                                                                                                                                                                                                                                                                                                            | pass   | Real end-to-end memory suite passed (black-box command probes + Rust regressions + Valkey cross-instance memory snapshot continuity).                                                                                                                                                                                                              |
| 2026-02-18 | local dev (macOS), live webhook runtime                                                          | `python3 scripts/channel/test_omni_agent_memory_suite.py --suite quick --require-live-turn --max-wait 90 --max-idle-secs 40 --username tao3k`                                                                                                                                                                                                                                                                                                                                                                           | pass   | Real non-command turn validated with memory recall planning/injection events and foreground reply in runtime dispatch logs.                                                                                                                                                                                                                        |
| 2026-02-18 | local dev (macOS), live webhook runtime                                                          | `python3 scripts/channel/test_omni_agent_memory_suite.py --suite quick --max-wait 30 --max-idle-secs 30 --username tao3k`                                                                                                                                                                                                                                                                                                                                                                                               | pass   | Real command-path black-box memory probes passed (`/session memory json`, `/session feedback up/down json`) with expected command events and JSON summaries.                                                                                                                                                                                       |
| 2026-02-20 | local dev (macOS), live webhook runtime + group profile (`.run/config/agent-channel-groups.env`) | `python3 scripts/channel/test_omni_agent_command_events.py --suite admin --admin-matrix --assert-admin-isolation --admin-group-chat-id -5101776367 --admin-group-chat-id -5020317863 --admin-group-chat-id -5292802281 --allow-chat-id -5101776367 --allow-chat-id -5020317863 --allow-chat-id -5292802281 --admin-user-id 1304799691 --max-wait 35 --max-idle-secs 25 --output-json .run/reports/command-events-admin-matrix-2026-02-20.json --output-markdown .run/reports/command-events-admin-matrix-2026-02-20.md` | pass   | Verified delegated-admin command matrix and cross-group isolation assertions on three real group chats; generated JSON/Markdown report artifacts under `.run/reports/`.                                                                                                                                                                            |
| 2026-02-20 | local dev (macOS), live webhook runtime + group profile (`.run/config/agent-channel-groups.env`) | `python3 scripts/channel/test_omni_agent_session_matrix.py --chat-id -5101776367 --chat-b -5020317863 --chat-c -5292802281 --user-a 1304799691 --user-b 1304799692 --user-c 1304799693 --max-wait 35 --max-idle-secs 25 --output-json .run/reports/session-matrix-2026-02-20.json --output-markdown .run/reports/session-matrix-2026-02-20.md`                                                                                                                                                                          | pass   | Verified session matrix full run (`20/20` steps) after making concurrent probe dedup-aware under webhook fail-open (Valkey dedup connection degradation).                                                                                                                                                                                          |
| 2026-02-18 | local dev (macOS), live webhook runtime                                                          | `just check-omni-agent-event-sequence .run/logs/omni-agent-webhook.log false true local`                                                                                                                                                                                                                                                                                                                                                                                                                                | pass   | Verified event-sequence checker on live logs with `require_memory=true` and expected memory backend `local`; memory recall lifecycle/order assertions passed.                                                                                                                                                                                      |
| 2026-02-18 | local dev (macOS)                                                                                | `python3 scripts/channel/test_omni_agent_memory_suite.py --suite full --skip-blackbox`                                                                                                                                                                                                                                                                                                                                                                                                                                  | pass   | New Python memory suite regression mode passed (`embedding endpoint down` fallback, `/session memory json`, `/session feedback json`, embedding auto-repair, and `embedding_repaired` snapshot-source coverage).                                                                                                                                   |
| 2026-02-18 | local dev (macOS)                                                                                | `just check-omni-agent-event-sequence .run/logs/omni-agent-webhook.log`                                                                                                                                                                                                                                                                                                                                                                                                                                                 | pass   | Verified compatibility entrypoint after Pythonizing event-sequence checker (`check-omni-agent-event-sequence.sh` now delegates to Python).                                                                                                                                                                                                         |
| 2026-02-18 | local dev (macOS), `VALKEY_URL=redis://127.0.0.1:6379/0`                                         | `python3 scripts/channel/test_omni_agent_valkey_suite.py --suite full redis://127.0.0.1:6379/0`                                                                                                                                                                                                                                                                                                                                                                                                                         | pass   | Python Valkey suite runner passed full 5-stage verification (stress + session gate + session context + dual-http + dual-process).                                                                                                                                                                                                                  |
| 2026-02-18 | local dev (macOS), `VALKEY_URL=redis://127.0.0.1:6379/0`                                         | `bash scripts/channel/test-omni-agent-valkey-session-context.sh redis://127.0.0.1:6379/0`                                                                                                                                                                                                                                                                                                                                                                                                                               | pass   | Wrapper path validated after Pythonization; executed exactly one focused cross-instance `/reset` + `/resume` restore test.                                                                                                                                                                                                                         |
| 2026-02-18 | local dev (macOS), `VALKEY_URL=redis://127.0.0.1:6379/0`                                         | `bash scripts/channel/test-omni-agent-valkey-multi-http.sh redis://127.0.0.1:6379/0`                                                                                                                                                                                                                                                                                                                                                                                                                                    | pass   | Wrapper path validated after Pythonization; executed exactly one focused dual-HTTP dedup test.                                                                                                                                                                                                                                                     |
| 2026-02-18 | local dev (macOS)                                                                                | `python3 scripts/channel/test_omni_agent_command_events.py --username tao3k --max-wait 25 --max-idle-secs 25`                                                                                                                                                                                                                                                                                                                                                                                                           | pass   | Pythonized command-event matrix probe validated end-to-end with latest webhook runtime.                                                                                                                                                                                                                                                            |
| 2026-02-18 | local dev (macOS)                                                                                | `python3 scripts/channel/test_omni_agent_dedup_events.py --max-wait 25`                                                                                                                                                                                                                                                                                                                                                                                                                                                 | pass   | Pythonized dedup probe validated deterministic first-accept + second-duplicate behavior for a single `update_id`.                                                                                                                                                                                                                                  |
| 2026-02-18 | local dev (macOS)                                                                                | `just agent-channel-blackbox-dedup 25`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | pass   | Added deterministic dedup black-box probe (same `update_id` posted twice) and verified runtime emits `telegram.dedup.update_accepted` then `telegram.dedup.duplicate_detected` for the same update id.                                                                                                                                             |
| 2026-02-18 | local dev (macOS)                                                                                | `bash scripts/channel/check-omni-agent-event-sequence.sh .run/logs/omni-agent-webhook.log --require-memory`                                                                                                                                                                                                                                                                                                                                                                                                             | pass   | Re-verified event-sequence checker after gate-backend-aware assertion update; `telegram.dedup.update_accepted` is now detected and memory-gate mode is reported as warning (non-fatal)                                                                                                                                                             |
| 2026-02-18 | local dev (macOS), `VALKEY_URL=redis://127.0.0.1:6379/0`                                         | `cargo test -p omni-agent --test channels_idempotency redis_store_marks_duplicate_ids -- --ignored --nocapture`                                                                                                                                                                                                                                                                                                                                                                                                         | pass   | Verified live Valkey dedup still enforces first-accept/second-duplicate semantics after dedup observability parity changes                                                                                                                                                                                                                         |
| 2026-02-18 | local dev (macOS)                                                                                | `cargo test -p omni-agent --test channels_idempotency -q`                                                                                                                                                                                                                                                                                                                                                                                                                                                               | pass   | Added live ignored Valkey dedup regression (`redis_store_marks_duplicate_ids`) and re-verified memory dedup tests after Valkey dedup observability parity (`update_accepted` / `duplicate_detected`)                                                                                                                                               |
| 2026-02-18 | local dev (macOS)                                                                                | `cargo test -p omni-agent --test observability_session_events -q`                                                                                                                                                                                                                                                                                                                                                                                                                                                       | pass   | Re-verified canonical observability event registry invariants after dedup observability improvements                                                                                                                                                                                                                                               |
| 2026-02-18 | local dev (macOS)                                                                                | `cargo test -p omni-agent --no-run`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | pass   | Re-verified compile path after Valkey dedup accepted/duplicate event emission hardening                                                                                                                                                                                                                                                            |
| 2026-02-18 | local dev (macOS)                                                                                | `cargo test -p omni-agent --test channels_webhook -q`                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | pass   | Re-verified webhook duplicate-filter behavior and fail-open path after Valkey dedup observability parity changes                                                                                                                                                                                                                                   |
| 2026-02-18 | local dev (macOS)                                                                                | `cargo test -p omni-agent --lib agent::memory_recall_feedback::tests -q`                                                                                                                                                                                                                                                                                                                                                                                                                                                | pass   | Verified structured recall-feedback signal priority (explicit user feedback > tool summary > assistant heuristic), tool-outcome inference invariants, and existing plan-adjustment invariants                                                                                                                                                      |
| 2026-02-18 | local dev (macOS)                                                                                | `cargo test -p omni-agent --no-run`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | pass   | Re-verified compile path after wiring tool execution diagnostics (`CallToolResult.is_error`) into recall feedback updates                                                                                                                                                                                                                          |
| 2026-02-18 | local dev (macOS)                                                                                | `cargo test -p omni-agent runtime_handle_inbound_session_memory -q`                                                                                                                                                                                                                                                                                                                                                                                                                                                     | pass   | Re-verified `/session memory` command behavior after recall-feedback source wiring changes                                                                                                                                                                                                                                                         |
| 2026-02-18 | local dev (macOS)                                                                                | `cargo test -p omni-memory --no-run`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | pass   | Verified `omni-memory` compile path is warning-clean after test cleanup (`unused mut` removal)                                                                                                                                                                                                                                                     |
| 2026-02-18 | local dev (macOS)                                                                                | `cargo test -p omni-agent --no-run`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | pass   | Verified `omni-agent` compile path remains warning-clean after memory persistence strict-startup changes                                                                                                                                                                                                                                           |
| 2026-02-18 | local dev (macOS)                                                                                | `cargo test -p omni-agent --test agent_memory_persistence_backend -q`                                                                                                                                                                                                                                                                                                                                                                                                                                                   | pass   | Verified Valkey strict-startup defaults (including `auto`+redis URL) and explicit relax mode (`persistence_strict_startup=false`) without local fallback                                                                                                                                                                                           |
| 2026-02-18 | local dev (macOS)                                                                                | `cargo test -p omni-agent --test config_settings -q`                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | pass   | Verified runtime settings merge now covers `memory.persistence_strict_startup` override precedence                                                                                                                                                                                                                                                 |
| 2026-02-18 | local dev (macOS)                                                                                | `cargo test -p omni-agent --lib agent::memory_recall_feedback_state::tests -q`                                                                                                                                                                                                                                                                                                                                                                                                                                          | pass   | Verified session-key persisted recall feedback bias roundtrip, clamp behavior, invalid payload handling, and optional live Valkey cross-instance case (ignored by default)                                                                                                                                                                         |
| 2026-02-18 | local dev (macOS)                                                                                | `cargo test -p omni-agent --lib agent::memory_recall_feedback::tests -q`                                                                                                                                                                                                                                                                                                                                                                                                                                                | pass   | Verified outcome-driven session recall feedback adaptation plan logic and invariants                                                                                                                                                                                                                                                               |
| 2026-02-18 | local dev (macOS)                                                                                | `cargo test -p omni-agent --test observability_session_events -q`                                                                                                                                                                                                                                                                                                                                                                                                                                                       | pass   | Verified new `agent.memory.recall.feedback_updated` observability event registration                                                                                                                                                                                                                                                               |
| 2026-02-18 | local dev (macOS)                                                                                | `cargo test -p omni-agent --test config_settings -q`                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | pass   | Verified runtime settings merge now includes canonical `embedding.*` keys and user override precedence (`embedding.dimension`)                                                                                                                                                                                                                     |
| 2026-02-18 | local dev (macOS)                                                                                | `cargo test -p omni-agent --lib agent::embedding_dimension::tests -q`                                                                                                                                                                                                                                                                                                                                                                                                                                                   | pass   | Verified embedding dimension auto-repair resampling behavior in dedicated `embedding_dimension/tests.rs` module                                                                                                                                                                                                                                    |
| 2026-02-18 | local dev (macOS)                                                                                | `cargo test -p omni-agent --lib agent::memory_recall_state::tests -q`                                                                                                                                                                                                                                                                                                                                                                                                                                                   | pass   | Verified `/session memory` snapshot normalization accepts `embedding_repaired` source in persisted payloads                                                                                                                                                                                                                                        |
| 2026-02-18 | local dev (macOS)                                                                                | `cargo test -p omni-agent --test channels_commands -q`                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | pass   | Re-verified command parsing aliases after embedding config and repair-path updates                                                                                                                                                                                                                                                                 |
| 2026-02-18 | local dev (macOS)                                                                                | `cargo test -p omni-agent runtime_handle_inbound_session_memory -q`                                                                                                                                                                                                                                                                                                                                                                                                                                                     | pass   | Re-verified `/session memory` dashboard/JSON output compatibility after embedding source expansion and `recall_feedback_bias` field exposure                                                                                                                                                                                                       |
| 2026-02-18 | local dev (macOS)                                                                                | `cargo test -p omni-agent --test agent_memory_persistence_backend -q`                                                                                                                                                                                                                                                                                                                                                                                                                                                   | pass   | Verified memory turn storage still succeeds when embedding endpoint `http://127.0.0.1:3302` is unavailable (independent test mode fallback)                                                                                                                                                                                                        |
| 2026-02-18 | local dev (macOS), `VALKEY_URL=redis://127.0.0.1:6379/0`                                         | `just test-omni-agent-valkey-full`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | pass   | Re-ran full 5-stage live suite after enabling recency-aware recall score fusion                                                                                                                                                                                                                                                                    |
| 2026-02-18 | local dev (macOS)                                                                                | `cargo test -p omni-agent --lib agent::memory_recall::tests -- --nocapture`                                                                                                                                                                                                                                                                                                                                                                                                                                             | pass   | Verified recency-aware fusion regression tests (recent preference on close scores; strong relevance still wins)                                                                                                                                                                                                                                    |
| 2026-02-18 | local dev (macOS), `VALKEY_URL=redis://127.0.0.1:6379/0`                                         | `cargo test -p omni-agent memory_recall_snapshot_is_shared_across_agent_instances_with_valkey -- --ignored --nocapture`                                                                                                                                                                                                                                                                                                                                                                                                 | pass   | Verified `/session memory` snapshot persistence is shared across two agent instances via Valkey-backed session store                                                                                                                                                                                                                               |
| 2026-02-18 | local dev (macOS)                                                                                | `cargo test -p omni-agent --lib agent::memory_recall_state::tests -- --nocapture`                                                                                                                                                                                                                                                                                                                                                                                                                                       | pass   | Verified local snapshot roundtrip, invalid payload handling, and embedding-source normalization in dedicated `memory_recall_state/tests.rs` module                                                                                                                                                                                                 |
| 2026-02-18 | local dev (macOS), `VALKEY_URL=redis://127.0.0.1:6379/0`                                         | `just test-omni-agent-valkey-full`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | pass   | Re-ran full 5-stage live suite after moving `/session memory` snapshots to shared session backend storage                                                                                                                                                                                                                                          |
| 2026-02-18 | local dev (macOS), `VALKEY_URL=redis://127.0.0.1:6379/0`                                         | `just test-omni-agent-valkey-full`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | pass   | Re-ran full 5-stage live suite after moving runtime `#[cfg(test)]` entry to `runtime/tests/mod.rs` and tightening `/session memory` field assertions                                                                                                                                                                                               |
| 2026-02-18 | local dev (macOS)                                                                                | `cargo test -p omni-agent --test channels_commands -q`                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | pass   | Verified `/session memory                                                                                                                                                                                                                                                                                                                          | recall`parser aliases and`json` format handling |
| 2026-02-18 | local dev (macOS)                                                                                | `cargo test -p omni-agent runtime_handle_inbound_session_memory -q`                                                                                                                                                                                                                                                                                                                                                                                                                                                     | pass   | Verified `/session memory` dashboard + JSON output includes `query_tokens`, `embedding_source`, `pipeline_duration_ms`, and `context_chars_injected` (with and without snapshots)                                                                                                                                                                  |
| 2026-02-18 | local dev (macOS)                                                                                | `cargo test -p omni-agent --lib agent::memory_recall::tests -- --nocapture`                                                                                                                                                                                                                                                                                                                                                                                                                                             | pass   | Verified adaptive memory recall planning/filter/context compaction logic                                                                                                                                                                                                                                                                           |
| 2026-02-18 | local dev (macOS)                                                                                | `cargo test -p omni-agent --test observability_session_events -q`                                                                                                                                                                                                                                                                                                                                                                                                                                                       | pass   | Verified new `agent.memory.recall.*` events are registered in canonical observability registry                                                                                                                                                                                                                                                     |
| 2026-02-18 | local dev (macOS), `VALKEY_URL=redis://127.0.0.1:6379/0`                                         | `just test-omni-agent-valkey-full`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | pass   | Re-ran full 5-stage live suite after upgrading `/session status` to dashboard output aligned with `/session budget`                                                                                                                                                                                                                                |
| 2026-02-18 | local dev (macOS), `VALKEY_URL=redis://127.0.0.1:6379/0`                                         | `just test-omni-agent-valkey-full`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | pass   | Re-ran full 5-stage live suite after upgrading `/session budget` to dashboard-style output (overview, class matrix, bottlenecks)                                                                                                                                                                                                                   |
| 2026-02-18 | local dev (macOS), `VALKEY_URL=redis://127.0.0.1:6379/0`                                         | `just test-omni-agent-valkey-full`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | pass   | Re-ran full 5-stage live suite after adding `/session budget` command and per-session context-budget snapshot reporting                                                                                                                                                                                                                            |
| 2026-02-18 | local dev (macOS), `VALKEY_URL=redis://127.0.0.1:6379/0`                                         | `just test-omni-agent-valkey-full`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | pass   | Re-ran full 5-stage live suite after adding strict context-budget strategy validation and fine-grained packing telemetry                                                                                                                                                                                                                           |
| 2026-02-18 | local dev (macOS)                                                                                | `cargo test -p omni-agent --test config_settings -q`                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | pass   | Verified settings merge chain includes `session.context_budget_strategy` and user override precedence                                                                                                                                                                                                                                              |
| 2026-02-18 | local dev (macOS)                                                                                | `cargo test -p omni-agent --test config_and_session -q`                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | pass   | Verified `AgentConfig` default strategy remains `recent_first` after introducing explicit strategy field                                                                                                                                                                                                                                           |
| 2026-02-18 | local dev (macOS), `VALKEY_URL=redis://127.0.0.1:6379/0`                                         | `just test-omni-agent-valkey-full`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | pass   | Re-ran full 5-stage live suite after context-budget V2 (summary-aware packing); no regressions in distributed webhook/session flows                                                                                                                                                                                                                |
| 2026-02-18 | local dev (macOS)                                                                                | `cargo test -p omni-agent --test agent_context_budget -q`                                                                                                                                                                                                                                                                                                                                                                                                                                                               | pass   | Verified summary-aware context packing: recent dialogue priority and newer-summary-first retention under tight token budget                                                                                                                                                                                                                        |
| 2026-02-18 | local dev (macOS), `VALKEY_URL=redis://127.0.0.1:6379/0`                                         | `just test-omni-agent-valkey-full`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | pass   | Verified Lua-atomic bounded context snapshot transitions (`/reset` + `/resume` + drop) with full 5-stage live suite                                                                                                                                                                                                                                |
| 2026-02-18 | local dev (macOS), `VALKEY_URL=redis://127.0.0.1:6379/0`                                         | `just test-omni-agent-valkey-session-context`                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | pass   | Verified `/reset` + `/resume` bounded context snapshot restore across two agent instances sharing the same Valkey prefix                                                                                                                                                                                                                           |
| 2026-02-18 | local dev (macOS), `VALKEY_URL=redis://127.0.0.1:6379/0`                                         | `just test-omni-agent-valkey-full`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | pass   | Re-ran full live suite after adding cross-instance session-context restore check (5/5 green)                                                                                                                                                                                                                                                       |
| 2026-02-18 | local dev (macOS)                                                                                | `cargo test -p omni-agent --test agent_session_context -q`                                                                                                                                                                                                                                                                                                                                                                                                                                                              | pass   | Verified bounded `/reset` + `/resume` now preserves window slot tool-call counters via raw slot snapshot/restore                                                                                                                                                                                                                                   |
| 2026-02-18 | local dev (macOS), `VALKEY_URL=redis://127.0.0.1:6379/0`                                         | `just test-omni-agent-valkey-full`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | pass   | Re-ran full live Valkey suite after bounded slot snapshot/restore refactor; all checks stayed green                                                                                                                                                                                                                                                |
| 2026-02-18 | local dev (macOS), `VALKEY_URL=redis://127.0.0.1:6379/0`                                         | `cargo test -p omni-agent --test telegram_session_gate -- --ignored --nocapture`                                                                                                                                                                                                                                                                                                                                                                                                                                        | pass   | Verified distributed SessionGate live checks (same session serializes; different sessions run in parallel)                                                                                                                                                                                                                                         |
| 2026-02-18 | local dev (macOS), `VALKEY_URL=redis://127.0.0.1:6379/0`                                         | `just test-omni-agent-valkey-full`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | pass   | Full suite passed after restoring `just` wrappers and re-adding the live dual-HTTP test selector                                                                                                                                                                                                                                                   |
| 2026-02-18 | local dev (macOS), `VALKEY_URL=redis://127.0.0.1:6379/0`                                         | `cargo test -p omni-agent --test channels_webhook_stress webhook_live_valkey_duplicate_update_id_across_two_http_servers_enqueues_once -- --ignored`                                                                                                                                                                                                                                                                                                                                                                    | pass   | Verified the focused dual-HTTP live dedup test now executes exactly one test (no false-positive 0-test pass)                                                                                                                                                                                                                                       |
| 2026-02-17 | local dev (macOS), `VALKEY_URL=redis://127.0.0.1:6379/0`                                         | `just test-omni-agent-valkey-full`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | pass   | Post-CI-workflow-integration local regression run passed                                                                                                                                                                                                                                                                                           |
| 2026-02-17 | local dev (macOS), `VALKEY_URL=redis://127.0.0.1:6379/0`                                         | `just test-omni-agent-valkey-multi-http`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | pass   | Real dual-HTTP-server dedup check passed                                                                                                                                                                                                                                                                                                           |
| 2026-02-17 | local dev (macOS), `VALKEY_URL=redis://127.0.0.1:6379/0`                                         | `just test-omni-agent-valkey-multi-process`                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | pass   | Real dual-process dedup check passed                                                                                                                                                                                                                                                                                                               |
| 2026-02-17 | local dev (macOS), `VALKEY_URL=redis://127.0.0.1:6379/0`                                         | `just test-omni-agent-valkey-stress`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | pass   | Stress suite passed (includes live Valkey ignored tests)                                                                                                                                                                                                                                                                                           |
| 2026-02-17 | local dev (macOS), `VALKEY_URL=redis://127.0.0.1:6379/0`                                         | `just test-omni-agent-valkey-full`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | pass   | Aggregated wrapper passed end-to-end                                                                                                                                                                                                                                                                                                               |

## Change Log

| Date (UTC) | Change                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | Evidence                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| ---------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 2026-02-20 | Hardened Python black-box harness partition handling and runtime inference: `agent_channel_blackbox.py` now accepts explicit `--session-partition` hints while preserving backward-compatible defaults, `test_omni_agent_command_events.py` propagates runtime partition mode into child probes, resolver log inference prefers the latest parsed-message shape, and concurrent/session-matrix probes now treat webhook dedup fail-open (`Webhook dedup check failed`) as valid acceptance path when parsed+reply events are present. | `scripts/channel/agent_channel_blackbox.py`, `scripts/channel/test_omni_agent_command_events.py`, `scripts/channel/test_config_resolver.py`, `scripts/channel/test_omni_agent_concurrent_sessions.py`, `packages/python/test-kit/tests/test_agent_channel_blackbox.py`, `packages/python/test-kit/tests/test_agent_channel_command_events.py`, `packages/python/test-kit/tests/test_agent_channel_concurrent_sessions.py`, `packages/python/test-kit/tests/test_agent_channel_session_matrix.py`                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 2026-02-20 | Switched Telegram default session partition to `chat` (same-group shared session by default, cross-group isolation retained), kept `chat_user` as optional strict isolation mode, updated settings/docs, and expanded default-mode regression coverage. Also removed implicit `OMNI_MCP_EMBED_URL` fallback URL from embedding client initialization to prevent hidden double-timeout when embedding endpoint is down (MCP fallback now explicit-only).                                                                               | `packages/rust/crates/omni-agent/src/channels/telegram/session_partition.rs`, `packages/conf/settings.yaml`, `docs/reference/telegram-channel.md`, `packages/rust/crates/omni-agent/tests/channels_telegram.rs`, `packages/rust/crates/omni-agent/tests/channels_session_partition.rs`, `packages/rust/crates/omni-agent/tests/config_settings.rs`, `packages/rust/crates/omni-agent/src/embedding.rs`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| 2026-02-19 | Added user-friendly Telegram managed-slash ACL fields (`slash_*_allow_from`) with priority chain (`slash_command_allow_from` > command allowlist > `admin_users`), wired through settings/env/CLI/runtime; also split oversized Telegram runtime command handler into focused modules (`jobs.rs` dispatch, `jobs/replies.rs`, `jobs/observability.rs`) and added standalone slash-ACL regressions.                                                                                                                                    | `packages/rust/crates/omni-agent/src/channels/telegram/channel/mod.rs`, `packages/rust/crates/omni-agent/src/channels/telegram/runtime/jobs.rs`, `packages/rust/crates/omni-agent/src/channels/telegram/runtime/jobs/replies.rs`, `packages/rust/crates/omni-agent/src/channels/telegram/runtime/jobs/observability.rs`, `packages/rust/crates/omni-agent/src/channels/traits.rs`, `packages/rust/crates/omni-agent/src/cli.rs`, `packages/rust/crates/omni-agent/src/main.rs`, `packages/rust/crates/omni-agent/src/nodes/channel/mod.rs`, `packages/rust/crates/omni-agent/src/nodes/channel/telegram.rs`, `packages/rust/crates/omni-agent/src/config/settings.rs`, `packages/rust/crates/omni-agent/tests/channels_telegram_slash_authorization.rs`, `packages/rust/crates/omni-agent/tests/telegram_runtime/session_slash_acl.rs`, `packages/rust/crates/omni-agent/tests/config_settings.rs`, `packages/conf/settings.yaml`, `docs/reference/telegram-channel.md` |
| 2026-02-19 | Replaced regex-based control-command rule grammar with user-friendly command-selector mapping (`<command-selector>=>users`), including exact selectors (`/session partition`), multi-selectors (`/reset,/clear`), wildcard groups (`session.*`), and `*`; updated Telegram/Discord authorization parsers, tests, and docs.                                                                                                                                                                                                            | `packages/rust/crates/omni-agent/src/channels/control_command_rule_specs.rs`, `packages/rust/crates/omni-agent/src/channels/telegram/channel/admin_rules.rs`, `packages/rust/crates/omni-agent/src/channels/discord/channel.rs`, `packages/rust/crates/omni-agent/tests/channels_control_command_authorization.rs`, `packages/rust/crates/omni-agent/tests/channels_discord.rs`, `packages/conf/settings.yaml`, `docs/reference/telegram-channel.md`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| 2026-02-19 | Refactored Rust binary entrypoint namespace from `main_*` to domain modules (`cli`, `resolve`, `agent_builder`, `nodes/*`) and split runtime modes into dedicated node modules; also completed Discord provider CLI wiring (`--provider discord`) with explicit runtime/settings resolution and ingress/session-partition config.                                                                                                                                                                                                     | `packages/rust/crates/omni-agent/src/main.rs`, `packages/rust/crates/omni-agent/src/cli.rs`, `packages/rust/crates/omni-agent/src/resolve.rs`, `packages/rust/crates/omni-agent/src/agent_builder.rs`, `packages/rust/crates/omni-agent/src/nodes/mod.rs`, `packages/rust/crates/omni-agent/src/nodes/channel/mod.rs`, `packages/rust/crates/omni-agent/src/nodes/channel/telegram.rs`, `packages/rust/crates/omni-agent/src/nodes/channel/discord.rs`, `packages/rust/crates/omni-agent/src/config/settings.rs`, `packages/rust/crates/omni-agent/tests/config_settings.rs`                                                                                                                                                                                                                                                                                                                                                                                            |
| 2026-02-19 | Added Discord REST send pipeline (`POST /channels/{id}/messages`) with typing indicator support (`POST /channels/{id}/typing`), UTF-8-safe message chunking to `DISCORD_MAX_MESSAGE_LENGTH` (2000 chars), and standalone send/chunk tests.                                                                                                                                                                                                                                                                                            | `packages/rust/crates/omni-agent/src/channels/discord/send.rs`, `packages/rust/crates/omni-agent/src/channels/discord/constants.rs`, `packages/rust/crates/omni-agent/src/channels/discord/client.rs`, `packages/rust/crates/omni-agent/src/channels/discord/channel.rs`, `packages/rust/crates/omni-agent/src/channels/discord/mod.rs`, `packages/rust/crates/omni-agent/src/channels/mod.rs`, `packages/rust/crates/omni-agent/src/lib.rs`, `packages/rust/crates/omni-agent/tests/channels_discord_send.rs`                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 2026-02-19 | Added Discord ingress/runtime skeleton: HTTP ingress endpoint (`/discord/ingress`), optional ingress secret validation (`x-omni-discord-ingress-token`), queue dispatch to agent turn execution, and standalone ingress tests (auth, enqueue, unauthorized ignore, partition behavior).                                                                                                                                                                                                                                               | `packages/rust/crates/omni-agent/src/channels/discord/runtime/mod.rs`, `packages/rust/crates/omni-agent/src/channels/discord/runtime/ingress.rs`, `packages/rust/crates/omni-agent/src/channels/discord/runtime/dispatch.rs`, `packages/rust/crates/omni-agent/src/channels/discord/mod.rs`, `packages/rust/crates/omni-agent/src/channels/mod.rs`, `packages/rust/crates/omni-agent/src/lib.rs`, `packages/rust/crates/omni-agent/tests/channels_discord_ingress.rs`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| 2026-02-19 | Added Discord session partition + gateway-message parsing foundation with runtime-toggle partition support (`guild_channel_user`, `channel`, `user`, `guild_user`) and dedicated isolation tests in standalone test file.                                                                                                                                                                                                                                                                                                             | `packages/rust/crates/omni-agent/src/channels/discord/session_partition.rs`, `packages/rust/crates/omni-agent/src/channels/discord/parsing.rs`, `packages/rust/crates/omni-agent/src/channels/discord/channel.rs`, `packages/rust/crates/omni-agent/src/channels/discord/mod.rs`, `packages/rust/crates/omni-agent/tests/channels_discord_parsing.rs`, `packages/rust/crates/omni-agent/src/channels/mod.rs`, `packages/rust/crates/omni-agent/src/lib.rs`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| 2026-02-19 | Added Discord channel skeleton with shared control-command policy chain (`DiscordControlCommandPolicy` + shared command-rule parser/auth resolver) and dedicated standalone tests; transport methods are explicitly unimplemented in this phase.                                                                                                                                                                                                                                                                                      | `packages/rust/crates/omni-agent/src/channels/discord/mod.rs`, `packages/rust/crates/omni-agent/src/channels/discord/channel.rs`, `packages/rust/crates/omni-agent/src/channels/mod.rs`, `packages/rust/crates/omni-agent/src/lib.rs`, `packages/rust/crates/omni-agent/tests/channels_discord.rs`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 2026-02-19 | Introduced structured Telegram control-command policy object (`TelegramControlCommandPolicy`) and policy-based runtime/webhook entrypoints to reduce constructor/runtime parameter bloat while keeping legacy wrappers intact.                                                                                                                                                                                                                                                                                                        | `packages/rust/crates/omni-agent/src/channels/control_command_authorization.rs`, `packages/rust/crates/omni-agent/src/channels/telegram/channel/mod.rs`, `packages/rust/crates/omni-agent/src/channels/telegram/runtime/mod.rs`, `packages/rust/crates/omni-agent/src/channels/telegram/runtime/webhook.rs`, `packages/rust/crates/omni-agent/src/channels/telegram/mod.rs`, `packages/rust/crates/omni-agent/src/channels/mod.rs`, `packages/rust/crates/omni-agent/src/lib.rs`, `packages/rust/crates/omni-agent/src/nodes/channel/telegram.rs`                                                                                                                                                                                                                                                                                                                                                                                                                       |
| 2026-02-19 | Refactored Telegram command-rule parsing into shared channels module for cross-channel reuse (`CommandSelectorAuthRule` + generic `<command-selector>=>users` parser), and split control-command authorization regressions into dedicated standalone test file to keep `channels_telegram.rs` focused.                                                                                                                                                                                                                                | `packages/rust/crates/omni-agent/src/channels/control_command_rule_specs.rs`, `packages/rust/crates/omni-agent/src/channels/telegram/channel/admin_rules.rs`, `packages/rust/crates/omni-agent/src/channels/mod.rs`, `packages/rust/crates/omni-agent/tests/channels_control_command_authorization.rs`, `packages/rust/crates/omni-agent/tests/channels_telegram.rs`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| 2026-02-19 | Added reusable control-command authorization policy module (`control_command_allow_from` override > command rules > admin fallback), wired Telegram to the shared policy, and introduced explicit control-command allowlist config/CLI/env (`telegram.control_command_allow_from`, `--control-command-allow-from`, `OMNI_AGENT_TELEGRAM_CONTROL_COMMAND_ALLOW_FROM`).                                                                                                                                                                 | `packages/rust/crates/omni-agent/src/channels/control_command_authorization.rs`, `packages/rust/crates/omni-agent/src/channels/telegram/channel/mod.rs`, `packages/rust/crates/omni-agent/src/channels/telegram/channel/admin_rules.rs`, `packages/rust/crates/omni-agent/src/channels/telegram/runtime/mod.rs`, `packages/rust/crates/omni-agent/src/channels/telegram/runtime/webhook.rs`, `packages/rust/crates/omni-agent/src/cli.rs`, `packages/rust/crates/omni-agent/src/nodes/channel/telegram.rs`, `packages/rust/crates/omni-agent/src/resolve.rs`, `packages/rust/crates/omni-agent/src/config/settings.rs`, `packages/rust/crates/omni-agent/tests/channels_telegram.rs`, `packages/rust/crates/omni-agent/tests/config_settings.rs`, `packages/conf/settings.yaml`, `docs/reference/telegram-channel.md`                                                                                                                                                   |
| 2026-02-19 | Extended Telegram control-command authorization checks from `/session partition ...` to mutating session controls: `/reset` (`/clear`), `/resume`, `/resume drop`; kept `/resume status` read-only. Added dedicated runtime tests in standalone file and updated docs for privileged-command model.                                                                                                                                                                                                                                   | `packages/rust/crates/omni-agent/src/channels/telegram/runtime/jobs.rs`, `packages/rust/crates/omni-agent/tests/telegram_runtime/session_control_admin.rs`, `packages/rust/crates/omni-agent/tests/telegram_runtime/mod.rs`, `docs/reference/telegram-channel.md`, `docs/testing/omni-agent-valkey-webhook-tracking.md`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| 2026-02-19 | Added per-command admin authorization rules for Telegram control commands (`<command-selector>=>users`), wired through settings/env/CLI/runtime/webhook, with selector-based rule matching and fallback to `admin_users` when no rule matches.                                                                                                                                                                                                                                                                                        | `packages/rust/crates/omni-agent/src/channels/telegram/channel/admin_rules.rs`, `packages/rust/crates/omni-agent/src/channels/telegram/channel/mod.rs`, `packages/rust/crates/omni-agent/src/channels/telegram/runtime/jobs.rs`, `packages/rust/crates/omni-agent/src/channels/telegram/runtime/mod.rs`, `packages/rust/crates/omni-agent/src/channels/telegram/runtime/webhook.rs`, `packages/rust/crates/omni-agent/src/channels/traits.rs`, `packages/rust/crates/omni-agent/src/cli.rs`, `packages/rust/crates/omni-agent/src/main.rs`, `packages/rust/crates/omni-agent/src/nodes/channel/telegram.rs`, `packages/rust/crates/omni-agent/src/config/settings.rs`, `packages/rust/crates/omni-agent/tests/channels_telegram.rs`, `packages/rust/crates/omni-agent/tests/telegram_runtime/session_partition.rs`, `packages/rust/crates/omni-agent/tests/config_settings.rs`, `packages/conf/settings.yaml`, `docs/reference/telegram-channel.md`                     |
| 2026-02-19 | Added admin allowlist control path for Telegram runtime session partition command (`/session partition ...`) with runtime mutability and config/CLI wiring (`telegram.admin_users` + `--admin-users` + `OMNI_AGENT_TELEGRAM_ADMIN_USERS`), plus focused regressions.                                                                                                                                                                                                                                                                  | `packages/rust/crates/omni-agent/src/channels/telegram/runtime/jobs.rs`, `packages/rust/crates/omni-agent/src/channels/telegram/channel/mod.rs`, `packages/rust/crates/omni-agent/src/channels/telegram/runtime/webhook.rs`, `packages/rust/crates/omni-agent/src/cli.rs`, `packages/rust/crates/omni-agent/src/nodes/channel/telegram.rs`, `packages/rust/crates/omni-agent/tests/channels_commands.rs`, `packages/rust/crates/omni-agent/tests/channels_webhook.rs`, `packages/rust/crates/omni-agent/tests/channels_webhook_stress.rs`, `packages/rust/crates/omni-agent/tests/telegram_runtime/session_partition.rs`, `packages/rust/crates/omni-agent/tests/config_settings.rs`, `packages/conf/settings.yaml`                                                                                                                                                                                                                                                     |
| 2026-02-18 | Extended concurrent session black-box probe to cover `cross-chat/same-user` isolation (new `--chat-b` target), added `--allow-send-failure` synthetic mode for environments without a second real chat, kept `same-chat/different-user` coverage, and added config validation to reject accidentally identical session targets plus dedicated Python tests.                                                                                                                                                                           | `scripts/channel/test_omni_agent_concurrent_sessions.py`, `packages/python/test-kit/tests/test_agent_channel_concurrent_sessions.py`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| 2026-02-18 | Added strict target-session assertions in webhook black-box probe: command reply/session summary and traced dispatch logs now fail when observed `session_key` does not match expected `chat_id[:thread_id]:user_id`; added dedicated test coverage for mismatch paths.                                                                                                                                                                                                                                                               | `scripts/channel/agent_channel_blackbox.py`, `packages/python/test-kit/tests/test_agent_channel_blackbox.py`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| 2026-02-18 | Enforced root-level memory scope isolation: `omni-memory` episodes now carry scope keys, scoped recall/store APIs were added, `omni-agent` now stores+recalls memory by `session_id` scope, and legacy agent episode IDs (`turn-*` / `consolidated-*`) are auto-migrated to inferred scope on load/store to preserve old data while preventing cross-session contamination.                                                                                                                                                           | `packages/rust/crates/omni-memory/src/episode.rs`, `packages/rust/crates/omni-memory/src/store.rs`, `packages/rust/crates/omni-agent/src/agent/mod.rs`, `packages/rust/crates/omni-agent/src/agent/persistence.rs`, `packages/rust/crates/omni-memory/tests/test_scope.rs`, `packages/rust/crates/omni-agent/tests/agent_memory_scope_isolation.rs`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| 2026-02-18 | Added unified Python memory A/B benchmark runner (`test_omni_agent_memory_benchmark.py`) with reproducible scenario dataset, compatibility shell wrapper, `just` entrypoint, and JSON+Markdown report outputs under `.run/reports/`.                                                                                                                                                                                                                                                                                                  | `scripts/channel/test_omni_agent_memory_benchmark.py`, `scripts/channel/test-omni-agent-memory-benchmark.sh`, `scripts/channel/fixtures/memory_benchmark_scenarios.json`, `justfile`, `.run/reports/omni-agent-memory-benchmark.md`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| 2026-02-18 | Fixed memory suite live-turn probe expectation to use stable memory observability event (`agent.memory.recall.planned`) instead of non-guaranteed foreground completion event, eliminating false timeout failures in real runtime verification.                                                                                                                                                                                                                                                                                       | `scripts/channel/test_omni_agent_memory_suite.py`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| 2026-02-18 | Fixed event-sequence checker expected-memory-backend matching to accept quoted token form (`backend=\"local\"` / `backend=\"valkey\"`) in structured logs.                                                                                                                                                                                                                                                                                                                                                                            | `scripts/channel/check_omni_agent_event_sequence.py`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| 2026-02-18 | Added unified Python memory suite runner (`test_omni_agent_memory_suite.py`) for Telegram/runtime memory checks (quick black-box probes + full Rust regressions + optional Valkey cross-instance continuity), with shell wrapper + `just` entrypoint compatibility.                                                                                                                                                                                                                                                                   | `scripts/channel/test_omni_agent_memory_suite.py`, `scripts/channel/test-omni-agent-memory-suite.sh`, `justfile`, `docs/reference/telegram-channel.md`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| 2026-02-18 | Pythonized observability event-sequence checker into `check_omni_agent_event_sequence.py`, with `check-omni-agent-event-sequence.sh` preserved as compatibility wrapper.                                                                                                                                                                                                                                                                                                                                                              | `scripts/channel/check_omni_agent_event_sequence.py`, `scripts/channel/check-omni-agent-event-sequence.sh`, `justfile`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| 2026-02-18 | Pythonized Valkey live-test suite harness into a unified runner (`test_omni_agent_valkey_suite.py`), and converted all `test-omni-agent-valkey-*.sh` entries into compatibility wrappers to preserve existing workflows.                                                                                                                                                                                                                                                                                                              | `scripts/channel/test_omni_agent_valkey_suite.py`, `scripts/channel/test-omni-agent-valkey-stress.sh`, `scripts/channel/test-omni-agent-valkey-session-gate.sh`, `scripts/channel/test-omni-agent-valkey-session-context.sh`, `scripts/channel/test-omni-agent-valkey-multi-http.sh`, `scripts/channel/test-omni-agent-valkey-multi-process.sh`, `scripts/channel/test-omni-agent-valkey-full.sh`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| 2026-02-18 | Pythonized Telegram black-box harnesses: command-event matrix and dedup probe now run from Python implementations, with shell scripts kept as compatibility wrappers.                                                                                                                                                                                                                                                                                                                                                                 | `scripts/channel/test_omni_agent_command_events.py`, `scripts/channel/test_omni_agent_dedup_events.py`, `scripts/channel/test-omni-agent-command-events.sh`, `scripts/channel/test-omni-agent-dedup-events.sh`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 2026-02-18 | Added deterministic webhook dedup black-box probe (`test-omni-agent-dedup-events.sh`) and `just` wrapper (`agent-channel-blackbox-dedup`) to assert first-accept + second-duplicate behavior for a single `update_id`, and relaxed reset snapshot-state log regex matching in command black-box matrix to accept quoted values.                                                                                                                                                                                                       | `scripts/channel/test-omni-agent-dedup-events.sh`, `justfile`, `scripts/channel/test-omni-agent-command-events.sh`, `docs/reference/telegram-channel.md`, `docs/testing/omni-agent-valkey-webhook-tracking.md`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 2026-02-18 | Made event-sequence checker session-gate-backend aware: missing lease events no longer fail command-only flows on memory gate backend, while valkey gate backend still enforces strict lease-event presence                                                                                                                                                                                                                                                                                                                           | `scripts/channel/check-omni-agent-event-sequence.sh`, `docs/testing/omni-agent-valkey-webhook-tracking.md`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| 2026-02-18 | Added Valkey dedup observability parity: accepted updates now emit `telegram.dedup.update_accepted`, duplicates emit `telegram.dedup.duplicate_detected`, aligned with memory backend semantics                                                                                                                                                                                                                                                                                                                                       | `packages/rust/crates/omni-agent/src/channels/telegram/idempotency.rs`, `packages/rust/crates/omni-agent/tests/channels_idempotency.rs`, `docs/testing/omni-agent-valkey-webhook-tracking.md`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 2026-02-18 | Upgraded recall feedback adaptation to structured signal priority: explicit user feedback markers first, MCP tool execution outcomes second (`CallToolResult.is_error` + transport failures), assistant-text heuristic fallback last                                                                                                                                                                                                                                                                                                  | `packages/rust/crates/omni-agent/src/agent/memory_recall_feedback.rs`, `packages/rust/crates/omni-agent/src/agent/mod.rs`, `packages/rust/crates/omni-agent/src/agent/mcp.rs`, `packages/rust/crates/omni-agent/tests/agent/memory_recall_feedback.rs`, `docs/reference/telegram-channel.md`, `docs/reference/omni-agent-memory-window-strategy-audit.md`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| 2026-02-18 | Hardened memory persistence startup semantics: Valkey-backed startup is strict by default (including `auto` with redis URL), with explicit opt-out via `memory.persistence_strict_startup` / `OMNI_AGENT_MEMORY_PERSISTENCE_STRICT_STARTUP`; added dedicated regression coverage                                                                                                                                                                                                                                                      | `packages/rust/crates/omni-agent/src/agent/memory_state.rs`, `packages/rust/crates/omni-agent/src/config/agent.rs`, `packages/rust/crates/omni-agent/src/config/settings.rs`, `packages/rust/crates/omni-agent/src/agent_builder.rs`, `packages/rust/crates/omni-agent/tests/agent_memory_persistence_backend.rs`, `packages/rust/crates/omni-agent/tests/config_settings.rs`, `packages/conf/settings.yaml`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| 2026-02-18 | Persisted session-level recall feedback bias into session backend key-space and loaded it on cache miss to keep adaptive recall continuity across process boundaries                                                                                                                                                                                                                                                                                                                                                                  | `packages/rust/crates/omni-agent/src/agent/memory_recall_feedback_state.rs`, `packages/rust/crates/omni-agent/tests/agent/memory_recall_feedback_state.rs`, `packages/rust/crates/omni-agent/src/agent/mod.rs`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 2026-02-18 | Exposed session-level recall adaptation signal as `recall_feedback_bias` in `/session memory` dashboard + JSON output for runtime inspection                                                                                                                                                                                                                                                                                                                                                                                          | `packages/rust/crates/omni-agent/src/agent/memory_recall_state.rs`, `packages/rust/crates/omni-agent/src/channels/telegram/runtime/jobs.rs`, `packages/rust/crates/omni-agent/tests/telegram_runtime/session_memory.rs`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| 2026-02-18 | Added session-level memory recall feedback adaptation (per-session bias update from assistant outcome) and emitted dedicated observability event `agent.memory.recall.feedback_updated`                                                                                                                                                                                                                                                                                                                                               | `packages/rust/crates/omni-agent/src/agent/memory_recall_feedback.rs`, `packages/rust/crates/omni-agent/src/agent/memory_recall_feedback/tests.rs`, `packages/rust/crates/omni-agent/src/agent/mod.rs`, `packages/rust/crates/omni-agent/src/agent/persistence.rs`, `packages/rust/crates/omni-agent/src/observability/session_events.rs`, `packages/rust/crates/omni-agent/tests/observability_session_events.rs`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 2026-02-18 | Unified memory embedding config resolution to canonical `embedding.*` settings keys (`model`, `litellm_model`, `dimension`, `client_url`), added embedding dimension auto-repair path (`embedding_repaired`), and added explicit independent-test fallback coverage for unavailable `3302` embedding endpoint                                                                                                                                                                                                                         | `packages/rust/crates/omni-agent/src/config/settings.rs`, `packages/rust/crates/omni-agent/src/agent_builder.rs`, `packages/rust/crates/omni-agent/src/config/agent.rs`, `packages/rust/crates/omni-agent/src/agent/mod.rs`, `packages/rust/crates/omni-agent/src/agent/embedding_dimension.rs`, `packages/rust/crates/omni-agent/src/agent/embedding_dimension/tests.rs`, `packages/rust/crates/omni-agent/src/agent/memory_recall_state.rs`, `packages/rust/crates/omni-agent/src/agent/memory_recall_state/tests.rs`, `packages/rust/crates/omni-agent/tests/agent_memory_persistence_backend.rs`, `docs/reference/telegram-channel.md`                                                                                                                                                                                                                                                                                                                              |
| 2026-02-18 | Added recency-aware memory-recall score fusion (time-decay + adaptive blend) and regression tests                                                                                                                                                                                                                                                                                                                                                                                                                                     | `packages/rust/crates/omni-agent/src/agent/memory_recall.rs`, `packages/rust/crates/omni-agent/src/agent/memory_recall/tests.rs`, `docs/reference/omni-agent-memory-window-strategy-audit.md`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 2026-02-18 | Persisted `/session memory` snapshots into session backend storage (special session key) instead of in-process map, enabling cross-instance inspection in Valkey deployments                                                                                                                                                                                                                                                                                                                                                          | `packages/rust/crates/omni-agent/src/agent/memory_recall_state.rs`, `packages/rust/crates/omni-agent/src/agent/memory_recall_state/tests.rs`, `packages/rust/crates/omni-agent/src/agent/mod.rs`, `docs/reference/telegram-channel.md`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| 2026-02-18 | Moved Telegram runtime `#[cfg(test)]` entrypoint from `runtime/tests.rs` to `runtime/tests/mod.rs` and kept dedicated `session_memory` test module under `runtime/tests/`                                                                                                                                                                                                                                                                                                                                                             | `packages/rust/crates/omni-agent/src/channels/telegram/runtime/mod.rs`, `packages/rust/crates/omni-agent/src/channels/telegram/runtime/tests/mod.rs`, `packages/rust/crates/omni-agent/src/channels/telegram/runtime/tests/session_memory.rs`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 2026-02-18 | Added Telegram `/session memory` diagnostics command (with `recall` alias and optional `json` format) backed by per-session memory-recall snapshots                                                                                                                                                                                                                                                                                                                                                                                   | `packages/rust/crates/omni-agent/src/channels/telegram/commands/session.rs`, `packages/rust/crates/omni-agent/src/channels/telegram/runtime/jobs.rs`, `packages/rust/crates/omni-agent/src/agent/memory_recall_state.rs`, `packages/rust/crates/omni-agent/src/channels/telegram/runtime/tests/session_memory.rs`, `packages/rust/crates/omni-agent/tests/channels_commands.rs`, `docs/reference/telegram-channel.md`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| 2026-02-18 | Added adaptive memory-recall planning (budget/window-aware k1/k2/lambda), bounded memory-context injection, and dedicated recall observability events (`planned/injected/skipped`)                                                                                                                                                                                                                                                                                                                                                    | `packages/rust/crates/omni-agent/src/agent/memory_recall.rs`, `packages/rust/crates/omni-agent/src/agent/mod.rs`, `packages/rust/crates/omni-agent/src/observability/session_events.rs`, `packages/rust/crates/omni-agent/src/agent/memory_recall/tests.rs`, `packages/rust/crates/omni-agent/tests/observability_session_events.rs`, `scripts/channel/check-omni-agent-event-sequence.sh`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| 2026-02-18 | Upgraded `/session status` output to dashboard format (overview + active window + saved snapshot sections) to match `/session budget` observability style                                                                                                                                                                                                                                                                                                                                                                             | `packages/rust/crates/omni-agent/src/channels/telegram/runtime/jobs.rs`, `packages/rust/crates/omni-agent/src/channels/telegram/runtime/tests/mod.rs`, `docs/reference/telegram-channel.md`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 2026-02-18 | Upgraded `/session budget` output to dashboard format (overview + per-class matrix + bottleneck hints) for faster runtime diagnostics in Telegram                                                                                                                                                                                                                                                                                                                                                                                     | `packages/rust/crates/omni-agent/src/channels/telegram/runtime/jobs.rs`, `packages/rust/crates/omni-agent/src/channels/telegram/runtime/tests/mod.rs`, `docs/reference/telegram-channel.md`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 2026-02-18 | Added Telegram `/session budget` command (with aliases) and wired per-session context-budget snapshot reporting to runtime responses                                                                                                                                                                                                                                                                                                                                                                                                  | `packages/rust/crates/omni-agent/src/channels/telegram/commands/session.rs`, `packages/rust/crates/omni-agent/src/channels/telegram/runtime/jobs.rs`, `packages/rust/crates/omni-agent/src/agent/context_budget_state.rs`, `packages/rust/crates/omni-agent/src/agent/mod.rs`, `packages/rust/crates/omni-agent/src/channels/telegram/runtime/tests/mod.rs`, `packages/rust/crates/omni-agent/tests/channels_commands.rs`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| 2026-02-18 | Added automated observability event-sequence checker (strict mode, memory-required mode, expected-backend assertion) and wired it into `just` commands                                                                                                                                                                                                                                                                                                                                                                                | `scripts/channel/check-omni-agent-event-sequence.sh`, `justfile`, `docs/testing/omni-agent-valkey-webhook-tracking.md`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| 2026-02-18 | Added configurable context budget strategy (`recent_first`/`summary_first`) through settings/env with strict invalid-value fail-fast validation, and expanded token-budget telemetry with per-class retain/drop/truncate counters                                                                                                                                                                                                                                                                                                     | `packages/rust/crates/omni-agent/src/config/agent.rs`, `packages/rust/crates/omni-agent/src/config/settings.rs`, `packages/rust/crates/omni-agent/src/agent_builder.rs`, `packages/rust/crates/omni-agent/src/agent/context_budget.rs`, `packages/rust/crates/omni-agent/src/agent/mod.rs`, `packages/conf/settings.yaml`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| 2026-02-18 | Added auto memory backend persistence tests (local persist, valkey no-fallback, invalid-URL fail-fast) and expanded memory persistence observability events (load/save success/failure with timing and counts)                                                                                                                                                                                                                                                                                                                        | `packages/rust/crates/omni-agent/tests/agent_memory_persistence_backend.rs`, `packages/rust/crates/omni-agent/src/agent/mod.rs`, `packages/rust/crates/omni-agent/src/agent/persistence.rs`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 2026-02-18 | Implemented context-budget V2 summary-aware packing (newest-summary preference, recent dialogue preserved before summary)                                                                                                                                                                                                                                                                                                                                                                                                             | `packages/rust/crates/omni-agent/src/agent/context_budget.rs`, `packages/rust/crates/omni-agent/src/agent/mod.rs`, `packages/rust/crates/omni-agent/tests/agent_context_budget.rs`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 2026-02-18 | Added Lua-atomic bounded snapshot transitions for session context reset/resume/drop in Valkey mode                                                                                                                                                                                                                                                                                                                                                                                                                                    | `packages/rust/crates/omni-agent/src/session/redis_backend.rs`, `packages/rust/crates/omni-agent/src/session/bounded_store.rs`, `packages/rust/crates/omni-agent/src/agent/session_context.rs`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 2026-02-18 | Added live cross-instance session-context restore verification (`/reset` + `/resume`) and integrated it into full Valkey suite                                                                                                                                                                                                                                                                                                                                                                                                        | `scripts/channel/test-omni-agent-valkey-session-context.sh`, `scripts/channel/test-omni-agent-valkey-full.sh`, `justfile`, `packages/rust/crates/omni-agent/tests/agent_session_context.rs`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 2026-02-18 | Refactored bounded context snapshot/restore to use raw window slots (preserves tool-count metadata across `/reset` + `/resume`)                                                                                                                                                                                                                                                                                                                                                                                                       | `packages/rust/crates/omni-agent/src/session/bounded_store.rs`, `packages/rust/crates/omni-agent/src/agent/session_context.rs`, `packages/rust/crates/omni-agent/tests/agent_session_context.rs`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 2026-02-18 | Added modular live SessionGate verification wrapper and included it in full Valkey verification flow                                                                                                                                                                                                                                                                                                                                                                                                                                  | `scripts/channel/test-omni-agent-valkey-session-gate.sh`, `scripts/channel/test-omni-agent-valkey-full.sh`, `justfile`, `packages/rust/crates/omni-agent/tests/telegram_session_gate.rs`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| 2026-02-18 | Restored modular `just` wrappers for `multi-http`, `multi-process`, and `full` live Valkey verification                                                                                                                                                                                                                                                                                                                                                                                                                               | `justfile`, `scripts/channel/test-omni-agent-valkey-*.sh`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| 2026-02-18 | Added live dual-HTTP ignored test function to match focused wrapper selector                                                                                                                                                                                                                                                                                                                                                                                                                                                          | `packages/rust/crates/omni-agent/tests/channels_webhook_stress.rs`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 2026-02-18 | Added explicit webhook builder with injectable session partition for routing-level isolation tests                                                                                                                                                                                                                                                                                                                                                                                                                                    | `packages/rust/crates/omni-agent/src/channels/telegram/runtime/webhook.rs`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| 2026-02-17 | Added process-level probe binary `webhook_dedup_probe`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `packages/rust/crates/omni-agent/src/bin/webhook_dedup_probe.rs`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 2026-02-17 | Added dual-process ignored integration test                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | `packages/rust/crates/omni-agent/tests/channels_webhook_process.rs`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| 2026-02-17 | Added focused wrappers for dual-HTTP and dual-process                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | `scripts/channel/test-omni-agent-valkey-multi-http.sh`, `scripts/channel/test-omni-agent-valkey-multi-process.sh`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| 2026-02-17 | Added full wrapper for one-command verification                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | `scripts/channel/test-omni-agent-valkey-full.sh`, `justfile`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| 2026-02-17 | Added nightly/manual CI workflow for full live Valkey verification                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | `.github/workflows/omni-agent-valkey-live.yaml`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |

## Maintenance Rule

When dedup, webhook, or Valkey transport behavior changes, rerun the canonical commands and append
a new row in **Latest Verification Snapshot** with date, command, and result.
