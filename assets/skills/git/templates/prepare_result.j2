{#
# git/prepare_result.j2 - Commit Preparation Result Template
#
# Enhanced with:
# - Truncated diff (50000 chars for detailed commit message generation)
# - File category breakdown for LLM analysis
# - Rich emoji UI for better audit experience
#}

## ğŸ“Š ğŸ” Raw Data (LLM Read This)

{% if valid_scopes %}
**ğŸ¯ Valid Scopes**: `{{ valid_scopes|join('`, `') }}`
{% endif %}

{% if scope_warning %}
âš ï¸  {{ scope_warning }}
{% endif %}

ğŸ“ **{{ staged_file_count }} Files to Commit**

{% for f in staged_files[:30] %}
- `{{ f }}`
{% endfor %}
{% if staged_file_count > 30 %}
- ... and {{ staged_file_count - 30 }} more files
{% endif %}

### ğŸ“ Files by Category

{% set docs = [] %}
{% set assets = [] %}
{% set packages = [] %}
{% set other = [] %}

{% for f in staged_files %}
{% if f.startswith('docs/') %}
{% set _ = docs.append(f) %}
{% elif f.startswith('assets/') %}
{% set _ = assets.append(f) %}
{% elif f.startswith('packages/') %}
{% set _ = packages.append(f) %}
{% else %}
{% set _ = other.append(f) %}
{% endif %}
{% endfor %}

| Category | Count | Examples |
|----------|-------|----------|
| ğŸ“š docs/ | {{ docs|length }} | {{ docs[:3]|join(', ') }}{% if docs|length > 3 %}...{% endif %} |
| ğŸ¨ assets/ | {{ assets|length }} | {{ assets[:3]|join(', ') }}{% if assets|length > 3 %}...{% endif %} |
| ğŸ“¦ packages/ | {{ packages|length }} | {{ packages[:3]|join(', ') }}{% if packages|length > 3 %}...{% endif %} |
| ğŸ”§ other | {{ other|length }} | {{ other[:3]|join(', ') }}{% if other|length > 3 %}...{% endif %} |

{% if diff_content %}
### ğŸ“ Diff Preview (50000 chars - enough for detailed message)

```diff
{{ diff_content[:50000] }}
```
_(Full diff: `git diff --cached`)_
{% endif %}

---

## ğŸ“‹ ğŸ“ Commit Analysis Reporter (LLM Fill Placeholders Below)

### ğŸ” Analysis

| Field           | Value               |
| --------------- | ------------------- |
| **Type**        | `feat` (fix/refactor/docs/style/test/chore) |
| **Scope**       | `agent` (pick from Valid Scopes above) |
| **Files**       | `{{ staged_file_count }}` files |
| **Description** | _REPLACE_WITH_SHORT_DESCRIPTION_ |

#### ğŸ“ Files Changed ({{ staged_file_count }})

{% for f in staged_files[:20] %}
- `{{ f }}`
{% endfor %}
{% if staged_file_count > 20 %}
- ... and {{ staged_file_count - 20 }} more files
{% endif %}

#### âœï¸  Message Template

**Subject:**

```
type(scope): _REPLACE_WITH_SHORT_DESCRIPTION_
```

**Body:**
- _REPLACE_WITH_CHANGE_DETAIL_1
- _REPLACE_WITH_CHANGE_DETAIL_2
- ...

---

### ğŸš€ Next Steps

1. ğŸ“– Read Raw Data above and analyze the diff
2. âœï¸  Fill the placeholders in Message Template
3. ğŸ’¬ Present the commit message to user
4. âœ… User replies **Yes** to commit, **No** to cancel
5. ğŸ¯ Execute:
   ```
   @omni git.smart_commit(action='approve', workflow_id='{{ wf_id }}', message='type(scope): description\n\n- detail1\n- detail2')
   ```

---

### â“ Confirmation

**Please confirm:** Reply **Yes** to commit, **No** to cancel.
